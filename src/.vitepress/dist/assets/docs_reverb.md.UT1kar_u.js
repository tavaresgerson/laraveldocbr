import{_ as s,c as a,o as e,a4 as i}from"./chunks/framework.nQaBHiNx.js";const g=JSON.parse('{"title":"Laravel Reverb","description":"","frontmatter":{},"headers":[],"relativePath":"docs/reverb.md","filePath":"docs/reverb.md"}'),n={name:"docs/reverb.md"},o=i(`<h1 id="laravel-reverb" tabindex="-1">Laravel Reverb <a class="header-anchor" href="#laravel-reverb" aria-label="Permalink to &quot;Laravel Reverb&quot;">​</a></h1><p><a name="introduction"></a></p><h2 id="introducao" tabindex="-1">Introdução <a class="header-anchor" href="#introducao" aria-label="Permalink to &quot;Introdução&quot;">​</a></h2><p><a href="https://github.com/laravel/reverb" target="_blank" rel="noreferrer">Laravel Reverb</a> traz comunicação WebSocket em tempo real extremamente rápida e escalável diretamente para seu aplicativo Laravel e fornece integração perfeita com o conjunto existente de <a href="/docs/broadcasting.html">ferramentas de transmissão de eventos</a> do Laravel.</p><p><a name="installation"></a></p><h2 id="instalacao" tabindex="-1">Instalação <a class="header-anchor" href="#instalacao" aria-label="Permalink to &quot;Instalação&quot;">​</a></h2><p>Você pode instalar o Reverb usando o comando Artisan <code>install:broadcasting</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>php artisan install:broadcasting</span></span></code></pre></div><p><a name="configuration"></a></p><h2 id="configuracao" tabindex="-1">Configuração <a class="header-anchor" href="#configuracao" aria-label="Permalink to &quot;Configuração&quot;">​</a></h2><p>Nos bastidores, o comando Artisan <code>install:broadcasting</code> executará o comando <code>reverb:install</code>, que instalará o Reverb com um conjunto sensato de opções de configuração padrão. Se você quiser fazer alguma alteração na configuração, pode fazê-lo atualizando as variáveis ​​de ambiente do Reverb ou atualizando o arquivo de configuração <code>config/reverb.php</code>.</p><p><a name="application-credentials"></a></p><h3 id="credenciais-do-aplicativo" tabindex="-1">Credenciais do aplicativo <a class="header-anchor" href="#credenciais-do-aplicativo" aria-label="Permalink to &quot;Credenciais do aplicativo&quot;">​</a></h3><p>Para estabelecer uma conexão com o Reverb, um conjunto de credenciais de &quot;aplicativo&quot; do Reverb deve ser trocado entre o cliente e o servidor. Essas credenciais são configuradas no servidor e são usadas para verificar a solicitação do cliente. Você pode definir essas credenciais usando as seguintes variáveis ​​de ambiente:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REVERB_APP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=my-app-id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REVERB_APP_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=my-app-key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REVERB_APP_SECRET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=my-app-secret</span></span></code></pre></div><p><a name="allowed-origins"></a></p><h3 id="origens-permitidas" tabindex="-1">Origens permitidas <a class="header-anchor" href="#origens-permitidas" aria-label="Permalink to &quot;Origens permitidas&quot;">​</a></h3><p>Você também pode definir as origens das quais as solicitações do cliente podem se originar atualizando o valor da configuração <code>allowed_origins</code> na seção <code>apps</code> do arquivo de configuração <code>config/reverb.php</code>. Quaisquer solicitações de uma origem não listada em suas origens permitidas serão rejeitadas. Você pode permitir todas as origens usando <code>*</code>:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my-app-id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;allowed_origins&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;laravel.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p><a name="additional-applications"></a></p><h3 id="aplicativos-adicionais" tabindex="-1">Aplicativos adicionais <a class="header-anchor" href="#aplicativos-adicionais" aria-label="Permalink to &quot;Aplicativos adicionais&quot;">​</a></h3><p>Normalmente, o Reverb fornece um servidor WebSocket para o aplicativo no qual está instalado. No entanto, é possível atender mais de um aplicativo usando uma única instalação do Reverb.</p><p>Por exemplo, você pode desejar manter um único aplicativo Laravel que, via Reverb, fornece conectividade WebSocket para vários aplicativos. Isso pode ser obtido definindo vários <code>apps</code> no arquivo de configuração <code>config/reverb.php</code> do seu aplicativo:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;app_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my-app-one&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;app_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my-app-two&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span></code></pre></div><p><a name="ssl"></a></p><h3 id="ssl" tabindex="-1">SSL <a class="header-anchor" href="#ssl" aria-label="Permalink to &quot;SSL&quot;">​</a></h3><p>Na maioria dos casos, as conexões WebSocket seguras são manipuladas pelo servidor web upstream (Nginx, etc.) antes que a solicitação seja enviada por proxy para seu servidor Reverb.</p><p>No entanto, às vezes pode ser útil, como durante o desenvolvimento local, para o servidor Reverb manipular conexões seguras diretamente. Se você estiver usando o recurso de site seguro do <a href="https://herd.laravel.com" target="_blank" rel="noreferrer">Laravel Herd</a> ou estiver usando o <a href="/docs/valet.html">Laravel Valet</a> e tiver executado o <a href="/docs/valet.html#securing-sites">comando secure</a> em seu aplicativo, você pode usar o certificado Herd / Valet gerado para seu site para proteger suas conexões Reverb. Para fazer isso, defina a variável de ambiente <code>REVERB_HOST</code> para o nome do host do seu site ou passe explicitamente a opção hostname ao iniciar o servidor Reverb:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reverb:start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --host=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --port=8080</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hostname=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;laravel.test&quot;</span></span></code></pre></div><p>Como os domínios Herd e Valet resolvem para <code>localhost</code>, executar o comando acima resultará no seu servidor Reverb sendo acessível por meio do protocolo WebSocket seguro (<code>wss</code>) em <code>wss://laravel.test:8080</code>.</p><p>Você também pode escolher manualmente um certificado definindo as opções <code>tls</code> no arquivo de configuração <code>config/reverb.php</code> do seu aplicativo. Dentro do array de opções <code>tls</code>, você pode fornecer qualquer uma das opções suportadas pelas <a href="https://www.php.net/manual/en/context.ssl.php" target="_blank" rel="noreferrer">opções de contexto SSL do PHP</a>:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;options&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;tls&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;local_cert&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/path/to/cert.pem&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span></code></pre></div><p><a name="running-server"></a></p><h2 id="executando-o-servidor" tabindex="-1">Executando o servidor <a class="header-anchor" href="#executando-o-servidor" aria-label="Permalink to &quot;Executando o servidor&quot;">​</a></h2><p>O servidor Reverb pode ser iniciado usando o comando Artisan <code>reverb:start</code>:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reverb:start</span></span></code></pre></div><p>Por padrão, o servidor Reverb será iniciado em <code>0.0.0.0:8080</code>, tornando-o acessível de todas as interfaces de rede.</p><p>Se você precisar especificar um host ou porta personalizado, você pode fazer isso através das opções <code>--host</code> e <code>--port</code> ao iniciar o servidor:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reverb:start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --host=127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --port=9000</span></span></code></pre></div><p>Alternativamente, você pode definir as variáveis ​​de ambiente <code>REVERB_SERVER_HOST</code> e <code>REVERB_SERVER_PORT</code> no arquivo de configuração <code>.env</code> do seu aplicativo.</p><p>As variáveis ​​de ambiente <code>REVERB_SERVER_HOST</code> e <code>REVERB_SERVER_PORT</code> não devem ser confundidas com <code>REVERB_HOST</code> e <code>REVERB_PORT</code>. As primeiras especificam o host e a porta nos quais executar o próprio servidor Reverb, enquanto o último par instrui o Laravel para onde enviar mensagens de transmissão. Por exemplo, em um ambiente de produção, você pode rotear solicitações do seu nome de host público do Reverb na porta <code>443</code> para um servidor Reverb operando em <code>0.0.0.0:8080</code>. Neste cenário, suas variáveis ​​de ambiente seriam definidas da seguinte forma:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REVERB_SERVER_HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REVERB_SERVER_PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=8080</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REVERB_HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=ws.laravel.com</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REVERB_PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=443</span></span></code></pre></div><p><a name="debugging"></a></p><h3 id="debugging" tabindex="-1">Debugging <a class="header-anchor" href="#debugging" aria-label="Permalink to &quot;Debugging&quot;">​</a></h3><p>Para melhorar o desempenho, o Reverb não emite nenhuma informação de depuração por padrão. Se você quiser ver o fluxo de dados passando pelo seu servidor Reverb, você pode fornecer a opção <code>--debug</code> para o comando <code>reverb:start</code>:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reverb:start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --debug</span></span></code></pre></div><p><a name="restarting"></a></p><h3 id="reiniciando" tabindex="-1">Reiniciando <a class="header-anchor" href="#reiniciando" aria-label="Permalink to &quot;Reiniciando&quot;">​</a></h3><p>Como o Reverb é um processo de longa duração, as alterações no seu código não serão refletidas sem reiniciar o servidor por meio do comando Artisan <code>reverb:restart</code>.</p><p>O comando <code>reverb:restart</code> garante que todas as conexões sejam encerradas normalmente antes de parar o servidor. Se você estiver executando o Reverb com um gerenciador de processos como o Supervisor, o servidor será reiniciado automaticamente pelo gerenciador de processos após todas as conexões terem sido encerradas:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reverb:restart</span></span></code></pre></div><p><a name="monitoring"></a></p><h2 id="monitoramento" tabindex="-1">Monitoramento <a class="header-anchor" href="#monitoramento" aria-label="Permalink to &quot;Monitoramento&quot;">​</a></h2><p>O Reverb pode ser monitorado por meio de uma integração com o <a href="/docs/pulse.html">Laravel Pulse</a>. Ao habilitar a integração do Reverb com o Pulse, você pode rastrear o número de conexões e mensagens sendo manipuladas pelo seu servidor.</p><p>Para habilitar a integração, você deve primeiro garantir que tenha <a href="/docs/pulse.html#installation">instalado o Pulse</a>. Em seguida, adicione qualquer um dos gravadores do Reverb ao arquivo de configuração <code>config/pulse.php</code> do seu aplicativo:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Laravel\\Reverb\\Pulse\\Recorders\\ReverbConnections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Laravel\\Reverb\\Pulse\\Recorders\\ReverbMessages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;recorders&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ReverbConnections</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;sample_rate&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ReverbMessages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;sample_rate&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span></code></pre></div><p>Em seguida, adicione os cartões Pulse para cada gravador ao seu <a href="/docs/pulse.html#dashboard-customization">painel do Pulse</a>:</p><div class="language-blade vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">blade</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">x-pulse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">livewire:reverb.connections</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cols</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;full&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">livewire:reverb.messages</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cols</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;full&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">x-pulse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p><a name="production"></a></p><h2 id="executando-o-reverb-em-producao" tabindex="-1">Executando o Reverb em produção <a class="header-anchor" href="#executando-o-reverb-em-producao" aria-label="Permalink to &quot;Executando o Reverb em produção&quot;">​</a></h2><p>Devido à natureza de longa execução dos servidores WebSocket, pode ser necessário fazer algumas otimizações no seu servidor e ambiente de hospedagem para garantir que seu servidor Reverb possa efetivamente lidar com o número ideal de conexões para os recursos disponíveis em seu servidor.</p><div class="info custom-block"><p class="custom-block-title">NOTA</p><p>Se seu site for gerenciado pelo <a href="https://forge.laravel.com" target="_blank" rel="noreferrer">Laravel Forge</a>, você pode otimizar automaticamente seu servidor para o Reverb diretamente do painel &quot;Aplicativo&quot;. Ao habilitar a integração do Reverb, o Forge garantirá que seu servidor esteja pronto para produção, incluindo a instalação de quaisquer extensões necessárias e o aumento do número permitido de conexões.</p></div><p><a name="open-files"></a></p><h3 id="arquivos-abertos" tabindex="-1">Arquivos abertos <a class="header-anchor" href="#arquivos-abertos" aria-label="Permalink to &quot;Arquivos abertos&quot;">​</a></h3><p>Cada conexão WebSocket é mantida na memória até que o cliente ou o servidor se desconecte. Em ambientes Unix e semelhantes ao Unix, cada conexão é representada por um arquivo. No entanto, geralmente há limites no número de arquivos abertos permitidos no nível do sistema operacional e do aplicativo.</p><p><a name="operating-system"></a></p><h4 id="sistema-operacional" tabindex="-1">Sistema operacional <a class="header-anchor" href="#sistema-operacional" aria-label="Permalink to &quot;Sistema operacional&quot;">​</a></h4><p>Em um sistema operacional baseado em Unix, você pode determinar o número permitido de arquivos abertos usando o comando <code>ulimit</code>:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ulimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span></span></code></pre></div><p>Este comando exibirá os limites de arquivos abertos permitidos para diferentes usuários. Você pode atualizar esses valores editando o arquivo <code>/etc/security/limits.conf</code>. Por exemplo, atualizar o número máximo de arquivos abertos para 10.000 para o usuário <code>forge</code> ficaria assim:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /etc/security/limits.conf</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">forge        soft  nofile  10000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">forge        hard  nofile  10000</span></span></code></pre></div><p><a name="event-loop"></a></p><h3 id="loop-de-eventos" tabindex="-1">Loop de eventos <a class="header-anchor" href="#loop-de-eventos" aria-label="Permalink to &quot;Loop de eventos&quot;">​</a></h3><p>Por baixo dos panos, o Reverb usa um loop de eventos ReactPHP para gerenciar conexões WebSocket no servidor. Por padrão, esse loop de eventos é alimentado por <code>stream_select</code>, que não requer nenhuma extensão adicional. No entanto, <code>stream_select</code> é normalmente limitado a 1.024 arquivos abertos. Dessa forma, se você planeja lidar com mais de 1.000 conexões simultâneas, precisará usar um loop de eventos alternativo não vinculado às mesmas restrições.</p><p>O Reverb alternará automaticamente para um loop alimentado por <code>ext-uv</code> quando disponível. Esta extensão PHP está disponível para instalação via PECL:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pecl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uv</span></span></code></pre></div><p><a name="web-server"></a></p><h3 id="servidor-web" tabindex="-1">Servidor Web <a class="header-anchor" href="#servidor-web" aria-label="Permalink to &quot;Servidor Web&quot;">​</a></h3><p>Na maioria dos casos, o Reverb é executado em uma porta não voltada para a web no seu servidor. Então, para rotear o tráfego para o Reverb, você deve configurar um proxy reverso. Supondo que o Reverb esteja sendo executado no host <code>0.0.0.0</code> e na porta <code>8080</code> e seu servidor utilize o servidor web Nginx, um proxy reverso pode ser definido para seu servidor Reverb usando a seguinte configuração de site Nginx:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_http_version </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $http_host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Scheme $scheme;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SERVER_PORT $server_port;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REMOTE_ADDR $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Upgrade $http_upgrade;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Connection </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Upgrade&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://0.0.0.0:8080;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Normalmente, os servidores web são configurados para limitar o número de conexões permitidas para evitar sobrecarga do servidor. Para aumentar o número de conexões permitidas em um servidor web Nginx para 10.000, os valores <code>worker_rlimit_nofile</code> e <code>worker_connections</code> do arquivo <code>nginx.conf</code> devem ser atualizados:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">user </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">forge;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_processes </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">auto;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pid </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/run/nginx.pid;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/nginx/modules-enabled/*.conf;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_rlimit_nofile </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  worker_connections </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  multi_accept </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>A configuração acima permitirá que até 10.000 workers Nginx por processo sejam gerados. Além disso, essa configuração define o limite de arquivos abertos do Nginx para 10.000.</p><p><a name="ports"></a></p><h3 id="portas" tabindex="-1">Portas <a class="header-anchor" href="#portas" aria-label="Permalink to &quot;Portas&quot;">​</a></h3><p>Os sistemas operacionais baseados em Unix geralmente limitam o número de portas que podem ser abertas no servidor. Você pode ver o intervalo permitido atual por meio do seguinte comando:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/net/ipv4/ip_local_port_range</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 32768	60999</span></span></code></pre></div><p>A saída acima mostra que o servidor pode manipular no máximo 28.231 (60.999 - 32.768) conexões, pois cada conexão requer uma porta livre. Embora recomendemos <a href="#scaling">escalonamento horizontal</a> para aumentar o número de conexões permitidas, você pode aumentar o número de portas abertas disponíveis atualizando o intervalo de portas permitidas no arquivo de configuração <code>/etc/sysctl.conf</code> do seu servidor.</p><p><a name="process-management"></a></p><h3 id="gerenciamento-de-processos" tabindex="-1">Gerenciamento de Processos <a class="header-anchor" href="#gerenciamento-de-processos" aria-label="Permalink to &quot;Gerenciamento de Processos&quot;">​</a></h3><p>Na maioria dos casos, você deve usar um gerenciador de processos como o Supervisor para garantir que o servidor Reverb esteja em execução contínua. Se estiver usando o Supervisor para executar o Reverb, você deve atualizar a configuração <code>minfds</code> do arquivo <code>supervisor.conf</code> do seu servidor para garantir que o Supervisor consiga abrir os arquivos necessários para manipular conexões com seu servidor Reverb:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[supervisord]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">minfds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=10000</span></span></code></pre></div><p><a name="scaling"></a></p><h3 id="escalonamento" tabindex="-1">Escalonamento <a class="header-anchor" href="#escalonamento" aria-label="Permalink to &quot;Escalonamento&quot;">​</a></h3><p>Se você precisar manipular mais conexões do que um único servidor permitirá, você pode escalonar seu servidor Reverb horizontalmente. Utilizando os recursos de publicação/assinatura do Redis, o Reverb consegue gerenciar conexões em vários servidores. Quando uma mensagem é recebida por um dos servidores Reverb do seu aplicativo, o servidor usará o Redis para publicar a mensagem recebida em todos os outros servidores.</p><p>Para habilitar o dimensionamento horizontal, você deve definir a variável de ambiente <code>REVERB_SCALING_ENABLED</code> como <code>true</code> no arquivo de configuração <code>.env</code> do seu aplicativo:</p><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>REVERB_SCALING_ENABLED=true</span></span></code></pre></div><p>Em seguida, você deve ter um servidor Redis central dedicado ao qual todos os servidores Reverb se comunicarão. O Reverb usará a <a href="/docs/redis.html#configuration">conexão Redis padrão configurada para seu aplicativo</a> para publicar mensagens em todos os seus servidores Reverb.</p><p>Depois de habilitar a opção de dimensionamento do Reverb e configurar um servidor Redis, você pode simplesmente invocar o comando <code>reverb:start</code> em vários servidores que podem se comunicar com seu servidor Redis. Esses servidores Reverb devem ser colocados atrás de um balanceador de carga que distribui as solicitações recebidas uniformemente entre os servidores.</p>`,99),t=[o];function r(p,l,d,h,c,k){return e(),a("div",null,t)}const v=s(n,[["render",r]]);export{g as __pageData,v as default};
